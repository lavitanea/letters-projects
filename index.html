<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Garden of Letters</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Georgia', serif;
    overflow: hidden;
    background: linear-gradient(180deg, #a8d8ea 0%, #c8e5f0 40%, #9ec89e 70%, #7ea85c 100%);
    position: relative;
  }
  .grass-layer { position: fixed; bottom: 0; left: 0; right: 0; height: 40%; background: repeating-linear-gradient(92deg,transparent,transparent 1px,rgba(107,142,35,.08) 1px,rgba(107,142,35,.08) 2px),repeating-linear-gradient(88deg,transparent,transparent 2px,rgba(85,107,47,.06) 2px,rgba(85,107,47,.06) 3px),linear-gradient(180deg,transparent 0%,rgba(85,107,47,.3) 50%,rgba(75,97,37,.5) 100%); pointer-events:none; }
  .grass-blade { position: fixed; bottom:0; width:2px; background:linear-gradient(to top,#5a7d3a,#8eb65e,transparent); transform-origin:bottom center; opacity:.5; animation:sway 3s ease-in-out infinite; }
  .grass-blade.tall { width:3px; opacity:.7; background:linear-gradient(to top,#4a6d2a,#7ea64e,transparent); }
  @keyframes sway {0%,100%{transform:rotate(-3deg);}50%{transform:rotate(3deg);}}
  .raindrop{position:fixed;width:2px;height:20px;background:linear-gradient(transparent,rgba(174,194,224,.6));animation:fall linear;pointer-events:none;}
  @keyframes fall{to{transform:translateY(100vh);}}
  #app{position:relative;height:100vh;overflow:hidden;}
  h1{position:absolute;left:32px;top:24px;color:#2c3e1f;font-weight:400;font-size:28px;text-shadow:0 2px 4px rgba(255,255,255,.5);} 
  #typedDisplay{position:absolute;left:32px;bottom:24px;background:rgba(255,255,255,.85);color:#2c3e1f;padding:12px 24px;border-radius:20px;border:2px solid rgba(255,255,255,.9);box-shadow:0 4px 12px rgba(0,0,0,.1);font-size:18px;font-family:'Courier New',monospace;max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:2px;min-width:200px;}
  #controls{position:absolute;right:24px;top:24px;display:flex;gap:12px;}
  button{background:rgba(255,255,255,.9);border:2px solid rgba(255,255,255,.95);padding:10px 20px;border-radius:20px;font-weight:600;font-size:14px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.15);color:#2c3e1f;transition:.2s;}
  .sun{position:fixed;top:80px;right:100px;width:80px;height:80px;background:radial-gradient(circle,#ffe66d 0%,#ffed4e 50%,transparent 70%);border-radius:50%;transition:opacity 1s;box-shadow:0 0 60px rgba(255,230,109,.6);} .sun.hidden{opacity:0;}
  canvas{display:block;}
</style>
</head>
<body>
<div class="grass-layer"></div>
<script>for(let i=0;i<150;i++){const b=document.createElement('div');b.className=Math.random()>0.7?'grass-blade tall':'grass-blade';b.style.left=Math.random()*100+'%';b.style.height=(15+Math.random()*50)+'px';b.style.animationDelay=Math.random()*3+'s';b.style.animationDuration=(2+Math.random()*3)+'s';document.body.appendChild(b);}</script>
<div class="sun" id="sun"></div>
<div id="app"><h1>The Garden of Letters</h1><div id="typedDisplay">Type to grow your garden...</div><div id="controls"><button id="clearBtn">Clear Garden</button><button id="exportBtn">Save Image</button></div><canvas id="visualCanvas"></canvas></div>
<audio id="rainSound" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_19f888c602.mp3?filename=rain-ambient-loop-110111.mp3"></audio>
<script>
(()=>{
const canvas=document.getElementById('visualCanvas'),ctx=canvas.getContext('2d',{alpha:true});let W=canvas.width=innerWidth,H=canvas.height=innerHeight;onresize=()=>{W=canvas.width=innerWidth;H=canvas.height=innerHeight;};
const trees=[],flowers=[],keyTimes=[],MIN_HISTORY=15;let typed='',currentStage=1,isRaining=false;
const rainSound=document.getElementById('rainSound');
const vowelColors={a:'#ffb3ba',e:'#ffffba',i:'#bae1ff',o:'#ffdfba',u:'#e0bbff'};
function random(a,b){return Math.random()*(b-a)+a;}
function createTree(x){const t={x1:x,y1:H-80,x2:x,y2:H-200,thickness:12,segments:[],branches:[]};t.segments=createSeg(t);return t;} function createSeg(b){const s=[];for(let i=0;i<=8;i++){const t=i/8,x=b.x1+(b.x2-b.x1)*t,y=b.y1+(b.y2-b.y1)*t,th=b.thickness*(1-t*.3);s.push({x,y,th});}return s;}
trees.push(createTree(W/2));
function addBranch(tree,parent){const base=parent.angle||-Math.PI/2,angle=base+random(-Math.PI/4,Math.PI/4),len=random(70,120),x1=parent.segments.at(-1).x,y1=parent.segments.at(-1).y,x2=x1+Math.cos(angle)*len,y2=y1+Math.sin(angle)*len,midX=x1+Math.cos(angle)*len*.5,midY=y1+Math.sin(angle)*len*.5,th=4+currentStage*1.5;const b={segments:[],tree,x1,y1,x2,y2,angle,th};for(let i=0;i<=6;i++){const t=i/6,x=(1-t)*(1-t)*x1+2*(1-t)*t*midX+t*t*x2,y=(1-t)*(1-t)*y1+2*(1-t)*t*midY+t*t*y2,th2=th*(1-t*.4);b.segments.push({x,y,th:th2});}tree.branches.push(b);} 
function addFlower(branch,letter){if(!branch) return;const seg=branch.segments[Math.floor(branch.segments.length*.6)],x=seg.x,y=seg.y;const f={x,y,char:letter,stage:currentStage,size:20,color:vowelColors[letter.toLowerCase()]||'#ffccdd',createdAt:performance.now(),floatPhase:Math.random()*6.28,rotationOffset:Math.random()*6.28};flowers.push(f);} 
function computeStage(){if(keyTimes.length<MIN_HISTORY)return 1;const r=keyTimes.slice(-MIN_HISTORY),d=r.slice(1).map((e,i)=>e-r[i]),avg=d.reduce((a,b)=>a+b)/d.length,kps=1000/avg;if(kps>7)startRain();else if(kps<4)stopRain();if(kps<2)return 1;if(kps<3.5)return 2;if(kps<5.5)return 3;return 4;} 
function startRain(){if(isRaining)return;isRaining=true;document.getElementById('sun').classList.add('hidden');rainSound.play();const int=setInterval(()=>{if(!isRaining)return clearInterval(int);for(let i=0;i<3;i++){const d=document.createElement('div');d.className='raindrop';d.style.left=Math.random()*100+'%';d.style.top='-20px';d.style.animationDuration=(.5+Math.random()*.3)+'s';document.body.appendChild(d);setTimeout(()=>d.remove(),1000);}},50);} 
function stopRain(){if(!isRaining)return;isRaining=false;document.getElementById('sun').classList.remove('hidden');rainSound.pause();rainSound.currentTime=0;currentStage=1;} 
function draw(){ctx.clearRect(0,0,W,H);trees.forEach(t=>{t.segments.forEach((s,i)=>{if(i<t.segments.length-1){const n=t.segments[i+1];ctx.lineWidth=s.th;ctx.strokeStyle='brown';ctx.beginPath();ctx.moveTo(s.x,s.y);ctx.lineTo(n.x,n.y);ctx.stroke();}});t.branches.forEach(b=>{b.segments.forEach((s,i)=>{if(i<b.segments.length-1){const n=b.segments[i+1];ctx.lineWidth=s.th;ctx.strokeStyle='brown';ctx.beginPath();ctx.moveTo(s.x,s.y);ctx.lineTo(n.x,n.y);ctx.stroke();}});});});flowers.forEach(f=>{const t=performance.now(),age=(t-f.createdAt)/1000,fx=f.x+Math.cos(t/1200+f.floatPhase)*2,fy=f.y+Math.sin(t/1000+f.floatPhase)*3;ctx.save();ctx.translate(fx,fy);ctx.scale(Math.min(1,age*3),Math.min(1,age*3));ctx.beginPath();ctx.arc(0,0,10,0,6.28);ctx.fillStyle=f.color;ctx.fill();ctx.restore();});requestAnimationFrame(draw);} draw();
document.onkeydown=e=>{if(e.key===' '){e.preventDefault();typed+=' ';document.getElementById('typedDisplay').innerText=typed;trees.push(createTree(W/(trees.length+1)*(trees.length+1)));return;}if(!/^[a-z]$/i.test(e.key))return;const now=performance.now();keyTimes.push(now);if(keyTimes.length>=MIN_HISTORY)currentStage=computeStage();typed+=e.key;document.getElementById('typedDisplay').innerText=typed;const tree=trees.at(-1);
if(/[aeiou]/i.test(e.key)){const branches=[...tree.branches];const br=branches.length?branches[Math.floor(Math.random()*branches.length)]:null;addFlower(br,e.key);}else addBranch(tree,tree.branches[Math.floor(Math.random()*tree.branches.length)]||tree);
};
document.getElementById('clearBtn').onclick=()=>location.reload();document.getElementById('exportBtn').onclick=()=>{const a=document.createElement('a');a.href=canvas.toDataURL();a.download='garden.png';a.click();};})();
</script>
</body>
</html>
